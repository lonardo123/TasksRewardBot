<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Investment</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  background:#020617;
  color:#fff;
  font-family:Arial, sans-serif;
  padding:20px;
}
.card {
  background:#1e293b;
  padding:15px;
  border-radius:10px;
  margin-bottom:15px;
}
input, button {
  width:100%;
  padding:10px;
  margin-top:10px;
  border-radius:6px;
  border:none;
}
button {
  background:#22c55e;
  color:#000;
  font-size:16px;
  cursor:pointer;
}
.message {
  margin-top:8px;
  font-size:14px;
  color:#22c55e;
}
.error {
  color:#ef4444;
}
table {
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th, td {
  border:1px solid #334155;
  padding:8px;
  text-align:left;
}
th {
  background:#334155;
}
</style>
</head>

<body>

<h2>âš™ï¸ Investment Admin</h2>

<!-- ğŸ”¹ ØªØºÙŠÙŠØ± Ø³Ø¹Ø± Ø§Ù„Ø³Ù‡Ù… -->
<div class="card">
  <h3>ğŸ’° Change Stock Price</h3>
  <input
    id="price"
    type="number"
    step="0.000001"
    min="0"
    placeholder="New price (e.g. 0.0001)">
  <button onclick="setPrice()">Update Price</button>
  <div id="priceMsg" class="message"></div>
</div>

<!-- ğŸ”¹ ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø´Ø±Ø§Ø¡ -->
<div class="card">
  <h3>ğŸ”’ Max Buy Limit</h3>
  <input
    id="max"
    type="number"
    step="1"
    min="0"
    placeholder="Max stocks">
  <button onclick="setMax()">Update Limit</button>
  <div id="maxMsg" class="message"></div>
</div>
<div class="card">
  <h3>ğŸ“¦ Total Available Stocks</h3>
  <input id="totalStocks" type="number" min="0" placeholder="Total stocks">
  <button onclick="setTotalStocks()">Update Total</button>
  <div id="totalMsg" class="message"></div>
</div>

<!-- ğŸ”¹ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ù‡Ù… -->
<div class="card">
  <h3>ğŸ“Š Users Stocks</h3>
  <table id="usersTable">
    <thead>
      <tr>
        <th>User (telegram_id)</th>
        <th>Balance ($)</th>
        <th>Total Stocks</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>


<script>
// =====================
// ØªØ­Ø¯ÙŠØ« Ø³Ø¹Ø± Ø§Ù„Ø³Ù‡Ù…
// =====================
async function setPrice(){
  const price = document.getElementById("price").value;
  const msg = document.getElementById("priceMsg");
  msg.textContent = "Updating...";
  msg.className = "message";

  try {
    const res = await fetch('/admin/set-price',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({ price })
    });
    const data = await res.json();

    if(data.success){
      msg.textContent = data.message || "âœ… Price updated successfully";
    } else {
      msg.textContent = data.message || "âŒ Failed to update price";
      msg.classList.add("error");
    }
  } catch(err){
    msg.textContent = "âŒ Server error";
    msg.classList.add("error");
  }
}

// =====================
// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰
// =====================
async function setMax(){
  const max = document.getElementById("max").value;
  const msg = document.getElementById("maxMsg");
  msg.textContent = "Updating...";
  msg.className = "message";

  try {
    const res = await fetch('/admin/set-max',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({ max })
    });
    const data = await res.json();

    if(data.success){
      msg.textContent = data.message || "âœ… Max buy updated successfully";
    } else {
      msg.textContent = data.message || "âŒ Failed to update max buy";
      msg.classList.add("error");
    }
  } catch(err){
    msg.textContent = "âŒ Server error";
    msg.classList.add("error");
  }
}
// =====================
// Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ù‡Ù… Ø§Ù„Ù…ØªØ§Ø­Ø©
// =====================  
async function setTotalStocks(){
  const total = document.getElementById("totalStocks").value;
  const msg = document.getElementById("totalMsg");
  msg.textContent = "Updating...";

  try{
    const res = await fetch('/admin/set-total-stocks',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ total })
    });
    const data = await res.json();

    if(data.success){
      msg.textContent = "âœ… Total stocks updated";
    }else{
      msg.textContent = data.message || "âŒ Error";
      msg.classList.add("error");
    }
  }catch{
    msg.textContent = "âŒ Server error";
    msg.classList.add("error");
  }
}

// =====================
// Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ø£Ø³Ù‡Ù…
// =====================
async function loadUsersStocks() {
  try {
    const res = await fetch('/admin/users-stocks');
    const users = await res.json();

    const tbody = document.querySelector('#usersTable tbody');
    tbody.innerHTML = '';

    users.forEach(u => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${u.user}</td>
        <td>${Number(u.balance).toFixed(6)}</td>
        <td>${u.total_stocks}</td>
      `;
      tbody.appendChild(tr);
    });

  } catch (err) {
    console.error('âŒ Error loading users stocks:', err);
  }
}
// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
loadUsersStocks();
</script>

</body>
</html>
