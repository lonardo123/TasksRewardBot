<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Investment</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  background:#020617;
  color:#fff;
  font-family:Arial;
  padding:20px;
}
.card {
  background:#1e293b;
  padding:15px;
  border-radius:10px;
  margin-bottom:15px;
}
input,button {
  width:100%;
  padding:10px;
  margin-top:10px;
  border-radius:5px;
}
button {
  background:#22c55e;
  border:none;
  font-size:16px;
  cursor:pointer;
}
.message {
  margin-top:8px;
  color:#22c55e;
  font-weight:bold;
}
table {
  width:100%;
  border-collapse:collapse;
}
th, td {
  border:1px solid #334155;
  padding:8px;
  text-align:left;
}
th {
  background:#334155;
}
</style>
</head>
<body>

<h2>âš™ï¸ Investment Admin</h2>

<!-- ØªØºÙŠÙŠØ± Ø³Ø¹Ø± Ø§Ù„Ø³Ù‡Ù… -->
<div class="card">
  <h3>ğŸ’° Change Stock Price</h3>
  <input id="price" placeholder="New price">
  <button onclick="setPrice()">Update Price</button>
  <div id="priceMsg" class="message"></div>
</div>

<!-- ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø´Ø±Ø§Ø¡ -->
<div class="card">
  <h3>ğŸ”’ Max Buy Limit</h3>
  <input id="max" placeholder="Max stocks">
  <button onclick="setMax()">Update Limit</button>
  <div id="maxMsg" class="message"></div>
</div>

<!-- Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ù‡Ù… -->
<div class="card">
  <h3>ğŸ“Š Users Stocks</h3>
  <table id="usersTable">
    <thead>
      <tr>
        <th>User (telegram_id)</th>
        <th>Balance ($)</th>
        <th>Total Stocks</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
// ØªØ­Ø¯ÙŠØ« Ø³Ø¹Ø± Ø§Ù„Ø³Ù‡Ù…
async function setPrice(){
  const v = document.getElementById("price").value;
  const msgDiv = document.getElementById("priceMsg");
  msgDiv.textContent = "Updating...";

  try{
    const res = await fetch('/admin/set-price',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({price:v})
    });
    const data = await res.json();
    msgDiv.textContent = data.message || "Price updated successfully!";
  }catch(err){
    msgDiv.textContent = "Error updating price!";
    console.error(err);
  }
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø´Ø±Ø§Ø¡
async function setMax(){
  const v = document.getElementById("max").value;
  const msgDiv = document.getElementById("maxMsg");
  msgDiv.textContent = "Updating...";

  try{
    const res = await fetch('/admin/set-max',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({max:v})
    });
    const data = await res.json();
    msgDiv.textContent = data.message || "Max buy updated successfully!";
  }catch(err){
    msgDiv.textContent = "Error updating max buy!";
    console.error(err);
  }
}

// Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ù‡Ù…
async function loadUsersStocks(){
  try {
    const res = await fetch('/admin/users-stocks');
    const users = await res.json();

    const tbody = document.querySelector("#usersTable tbody");
    tbody.innerHTML = "";

    users.forEach(u=>{
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${u.user}</td>
        <td>${parseFloat(u.balance).toFixed(2)}</td>
        <td>${u.total_stocks}</td>
      `;
      tbody.appendChild(tr);
    });
  } catch(err){
    console.error("Error fetching users stocks:", err);
  }
}

// Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
loadUsersStocks();
</script>

</body>
</html>
