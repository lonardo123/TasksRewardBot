<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>User Investment</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  background:#020617;
  color:#fff;
  font-family:Arial;
  padding:20px;
}
.card {
  background:#1e293b;
  padding:15px;
  border-radius:10px;
  margin-bottom:15px;
}
.message {
  margin-top:10px;
  color:#22c55e;
  font-weight:bold;
}
</style>
</head>
<body>

<h2>ğŸ’° My Investment</h2>

<div class="card">
  <p id="priceDisplay">ğŸ’° Price: ...</p>
  <p id="stocksDisplay">ğŸ“¦ My Stocks: ...</p>
  <p id="maxDisplay">ğŸ”’ Max Buy: ...</p>
  <div id="actionMsg" class="message"></div>
</div>

<script>
const user_id = 123456789; // Ø§Ø³ØªØ¨Ø¯Ù„ Ø¨Ù€ telegram_id Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…

// Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±
async function loadInvestment(){
  const priceEl = document.getElementById("priceDisplay");
  const stocksEl = document.getElementById("stocksDisplay");
  const maxEl = document.getElementById("maxDisplay");

  try{
    const res = await fetch(`/api/investment-data?user_id=${user_id}`);
    const data = await res.json();

    priceEl.textContent = `ğŸ’° Price: ${data.price ?? 0}$`;
    stocksEl.textContent = `ğŸ“¦ My Stocks: ${data.stocks ?? 0}`;
    maxEl.textContent = `ğŸ”’ Max Buy: ${data.max_buy ?? 0}`;
  }catch(err){
    console.error(err);
    priceEl.textContent = `ğŸ’° Price: error`;
    stocksEl.textContent = `ğŸ“¦ My Stocks: error`;
    maxEl.textContent = `ğŸ”’ Max Buy: error`;
  }
}

// Ø¨Ø¹Ø¯ Ø£ÙŠ Ø¹Ù…Ù„ÙŠØ© Ø´Ø±Ø§Ø¡ Ø£Ùˆ Ø¨ÙŠØ¹
function showActionMessage(msg){
  const msgDiv = document.getElementById("actionMsg");
  msgDiv.textContent = msg;
  setTimeout(()=> msgDiv.textContent = "", 3000);
}

// Ù…Ø«Ø§Ù„ Ø¹Ù„Ù‰ Ø´Ø±Ø§Ø¡ Ø³Ù‡Ù…
async function buyStock(){
  try{
    const res = await fetch(`/api/buy-stock?user_id=${user_id}`, {method:'POST'});
    const data = await res.json();
    if(data.success){
      showActionMessage("âœ… Stock bought successfully!");
      loadInvestment();
    }else{
      showActionMessage("âŒ " + (data.message || "Error buying stock"));
    }
  }catch(err){
    console.error(err);
    showActionMessage("âŒ Error buying stock");
  }
}

// Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
loadInvestment();
</script>

</body>
</html>
