<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>User Investment</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  background:#020617;
  color:#fff;
  font-family:Arial, sans-serif;
  padding:20px;
}
.card {
  background:#1e293b;
  padding:15px;
  border-radius:10px;
  margin-bottom:15px;
}
button {
  width:100%;
  padding:10px;
  margin-top:10px;
  border-radius:6px;
  border:none;
  background:#22c55e;
  color:#000;
  font-size:16px;
  cursor:pointer;
}
.message {
  margin-top:10px;
  font-weight:bold;
  color:#22c55e;
}
.error {
  color:#ef4444;
}
</style>
</head>

<body>

<h2>ğŸ’° My Investment</h2>

<div class="card">
  <p id="priceDisplay">ğŸ’° Price: 0$</p>
  <p id="stocksDisplay">ğŸ“¦ My Stocks: 0</p>
  <p id="maxDisplay">ğŸ”’ Max Buy: 0</p>

  <button onclick="buyStock()">â• Buy Stock</button>
  <button onclick="sellStock()">â– Sell Stock</button>

  <div id="actionMsg" class="message"></div>
</div>

<script>
// =====================
// telegram_id Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
// =====================
const telegram_id = 123456789; // ÙŠØªÙ… ØªÙ…Ø±ÙŠØ±Ù‡ Ù…Ù† Ø§Ù„Ø¨ÙˆØª Ø£Ùˆ Ø§Ù„Ø³ÙŠØ±ÙØ±

// =====================
// ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±
// =====================
async function loadInvestment(){
  const priceEl = document.getElementById("priceDisplay");
  const stocksEl = document.getElementById("stocksDisplay");
  const maxEl = document.getElementById("maxDisplay");

  try {
    const res = await fetch(`/api/investment-data?telegram_id=${telegram_id}`);
    const data = await res.json();

    priceEl.textContent  = `ğŸ’° Price: ${Number(data.price || 0).toFixed(6)}$`;
    stocksEl.textContent = `ğŸ“¦ My Stocks: ${data.stocks || 0}`;
    maxEl.textContent    = `ğŸ”’ Max Buy: ${data.max_buy || 0}`;
  } catch (err) {
    priceEl.textContent  = "ğŸ’° Price: error";
    stocksEl.textContent = "ğŸ“¦ My Stocks: error";
    maxEl.textContent    = "ğŸ”’ Max Buy: error";
  }
}

// =====================
// Ø±Ø³Ø§Ù„Ø© Ø¯Ø§Ø®Ù„ÙŠØ©
// =====================
function showMessage(text, isError = false){
  const msg = document.getElementById("actionMsg");
  msg.textContent = text;
  msg.className = isError ? "message error" : "message";
}

// =====================
// Ø´Ø±Ø§Ø¡ Ø³Ù‡Ù…
// =====================
async function buyStock(){
  showMessage("Processing...");

  try {
    const res = await fetch('/api/buy-stock', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({ telegram_id })
    });
    const data = await res.json();

    if(data.success){
      showMessage("âœ… Stock bought successfully");
      loadInvestment();
    } else {
      showMessage(data.message || "âŒ Cannot buy stock", true);
    }
  } catch(err){
    showMessage("âŒ Server error", true);
  }
}

// =====================
// Ø¨ÙŠØ¹ Ø³Ù‡Ù…
// =====================
async function sellStock(){
  showMessage("Processing...");

  try {
    const res = await fetch('/api/sell-stock', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({ telegram_id })
    });
    const data = await res.json();

    if(data.success){
      showMessage("âœ… Stock sold successfully");
      loadInvestment();
    } else {
      showMessage(data.message || "âŒ Cannot sell stock", true);
    }
  } catch(err){
    showMessage("âŒ Server error", true);
  }
}

// =====================
// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
// =====================
loadInvestment();
</script>

</body>
</html>
