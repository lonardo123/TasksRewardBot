<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ÙÙŠØ¯ÙŠÙˆÙ‡Ø§ØªÙŠ - TasksRewardBot</title>
  <style>
    :root{
      --bg:#f5f7fb; --card:#fff; --muted:#6b7280; --accent:#0ea5a4; --danger:#ef4444;
      --radius:10px; --pad:18px; --mono: "Roboto Mono", monospace;
    }
    body{font-family: "Noto Kufi Arabic", "Segoe UI", Tahoma, Arial; background:var(--bg); margin:0; padding:24px; color:#111;}
    .wrap{max-width:980px;margin:0 auto;}
    .header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:0 4px 18px rgba(15,23,42,0.06);padding:var(--pad);margin-bottom:16px}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    button{background:#111;color:#fff;border:0;padding:10px 14px;border-radius:8px;cursor:pointer}
    button.ghost{background:transparent;color:#111;border:1px solid #e5e7eb}
    .hidden{display:none}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type=text], input[type=url], input[type=number], select, textarea{
      width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9ef;font-size:14px;box-sizing:border-box;
    }
    .grid{display:grid;grid-template-columns:1fr 320px;gap:14px;align-items:start}
    .full{grid-column:1/-1}
    .keywords-row{display:flex;gap:8px;align-items:center;margin-top:8px}
    .keywords-row input{flex:1}
    .pill{display:inline-block;background:#f3f4f6;padding:6px 10px;border-radius:999px;margin:4px;font-size:13px;color:#111}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th, td{border:1px solid #eef2f7;padding:8px;text-align:center;font-size:14px}
    th{background:#f8fafc}
    .msg{padding:12px;border-radius:8px;margin-bottom:12px;display:none}
    .msg.error{background:#fff5f5;color:var(--danger);border:1px solid #fecaca}
    .msg.success{background:#ecfdf5;color:#065f46;border:1px solid #bbf7d0}
    .small{font-size:13px;color:var(--muted)}
    .muted{color:var(--muted)}
    .input-inline{display:flex;gap:8px}
    .input-inline input{flex:1}
    .meta{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .note{font-size:13px;color:var(--muted);margin-top:6px}
    .actions button{padding:8px 10px;border-radius:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <h1>ÙÙŠØ¯ÙŠÙˆÙ‡Ø§ØªÙŠ</h1>
      <div class="controls">
        <button id="listBtn">ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© ÙÙŠØ¯ÙŠÙˆÙ‡Ø§ØªÙŠ</button>
        <button id="addBtn">â• Ø¥Ø¶Ø§ÙØ© ÙÙŠØ¯ÙŠÙˆ Ø¬Ø¯ÙŠØ¯</button>
      </div>
    </div>

    <div id="messageBox" class="msg"></div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø¶Ø§ÙØ© -->
    <div id="addForm" class="card hidden">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>Ø¥Ø¶Ø§ÙØ© ÙÙŠØ¯ÙŠÙˆ Ø¬Ø¯ÙŠØ¯</strong>
        <div class="small muted">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª: 4</div>
      </div>

      <div style="margin-top:12px" class="grid">
        <div>
          <label>Ø§Ø³Ù… Ø§Ù„Ø­Ù…Ù„Ø© / Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ <span class="small muted">(Required)</span></label>
          <input id="title" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø´Ø±Ø­ Ø¨Ø³ÙŠØ·" />
        </div>

        <div>
          <label>Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (ÙŠÙˆØªÙŠÙˆØ¨) <span class="small muted">(Required)</span></label>
          <input id="url" type="url" placeholder="https://www.youtube.com/watch?v=..." />
        </div>

        <div>
          <label>Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© (Ø«ÙˆØ§Ù†Ù)</label>
          <div class="input-inline">
            <input id="min_duration" type="number" value="60" min="50" />
            <input id="max_duration" type="number" value="120" min="50" />
          </div>
          <div class="note">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ 50 Ø«Ø§Ù†ÙŠØ© â€” ÙŠÙØ³ØªØ®Ø¯Ù… Ù„Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø¨ÙŠÙ† Ø§Ù„Ø­Ø¯ÙŠÙ†</div>
        </div>

        <div>
          <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©</label>
          <!-- according to your request viewing_method fixed to "keyword" -->
          <select id="viewing_method" disabled>
            <option value="keyword" selected>Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© (Ø«Ø§Ø¨Øª)</option>
          </select>
          <div class="note">Ø³ÙŠØªÙ… Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© ÙÙ‚Ø· (Ø«Ø§Ø¨Øª)</div>
        </div>

        <div class="full">
          <label>Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© (Ø­ØªÙ‰ 5 ÙƒÙ„Ù…Ø§Øª)</label>
          <div id="keywordsContainer">
            <div class="keywords-row">
              <input class="keyword" placeholder="ÙƒÙ„Ù…Ø© Ù…ÙØªØ§Ø­ÙŠØ© 1" />
              <button type="button" id="addKeywordBtn">â•</button>
            </div>
          </div>
          <div class="note">Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø§Øª ØªØ³Ø§Ø¹Ø¯ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙÙŠØ¯ÙŠÙˆ ÙÙŠ Ø¨Ø­Ø« ÙŠÙˆØªÙŠÙˆØ¨. Ø£Ù‚ØµÙ‰ Ø¹Ø¯Ø¯: 5.</div>
        </div>

        <div>
          <label>Ø¥Ø¹Ø¬Ø§Ø¨ (Like)</label>
          <!-- fixed to "no" as requested -->
          <select id="like" disabled>
            <option value="no" selected>Ù„Ø§</option>
          </select>
        </div>

        <div>
          <label>Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ (Subscribe)</label>
          <select id="subscribe" disabled>
            <option value="no" selected>Ù„Ø§</option>
          </select>
        </div>

        <div>
          <label>Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ (Comment)</label>
          <select id="comment" disabled>
            <option value="no" selected>Ù„Ø§</option>
          </select>
        </div>

        <div>
          <label>Ø¥Ø¹Ø¬Ø§Ø¨ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª (Comment Liking)</label>
          <select id="comment_liking" disabled>
            <option value="no" selected>Ù„Ø§</option>
          </select>
        </div>

        <div class="full" style="display:flex;justify-content:flex-end;gap:8px;margin-top:10px">
          <button id="submitBtn">Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</button>
          <button id="cancelBtn" class="ghost">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
      </div>
    </div>

    <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª -->
    <div id="videosSection" class="card hidden">
      <strong>Ù‚Ø§Ø¦Ù…Ø© ÙÙŠØ¯ÙŠÙˆÙ‡Ø§ØªÙƒ</strong>
      <div class="note" style="margin-top:8px">ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø°Ù Ø£ÙŠ ÙÙŠØ¯ÙŠÙˆ Ø¨Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø­Ø°Ù.</div>
      <table>
        <thead>
          <tr>
            <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
            <th>Ø§Ù„Ù…Ø¯Ø© (Ø«)</th>
            <th>Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª</th>
            <th>Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©</th>
            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody id="videosTableBody">
          <tr><td colspan="5">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    // userId ÙŠÙ„ØªÙ‚Ø· Ù…Ù† Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…ØŒ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙÙ…Ø±Ø± Ù†Ø³ØªØ®Ø¯Ù… Ù…Ø«Ø§Ù„ (Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±)
    const userId = new URLSearchParams(window.location.search).get('user_id') || '';

    // Ø¹Ù†Ø§ØµØ± DOM
    const addBtn = document.getElementById('addBtn');
    const listBtn = document.getElementById('listBtn');
    const addForm = document.getElementById('addForm');
    const videosSection = document.getElementById('videosSection');
    const keywordsContainer = document.getElementById('keywordsContainer');
    const addKeywordBtn = document.getElementById('addKeywordBtn');
    const submitBtn = document.getElementById('submitBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const messageBox = document.getElementById('messageBox');
    const videosTableBody = document.getElementById('videosTableBody');

    let currentVideos = [];

    function showMessage(text, type='error') {
      messageBox.style.display = 'block';
      messageBox.textContent = text;
      messageBox.className = 'msg';
      if (type === 'error') messageBox.classList.add('error');
      else if (type === 'success') messageBox.classList.add('success');
      // auto hide after 6s
      clearTimeout(window._msgTimer);
      window._msgTimer = setTimeout(()=>messageBox.style.display='none',6000);
    }

    // Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ© (Ø­ØªÙ‰ 5)
    addKeywordBtn.addEventListener('click', () => {
      const count = keywordsContainer.querySelectorAll('input.keyword').length;
      if (count >= 5) { showMessage('ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© 5 ÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ© ÙÙ‚Ø· ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰', 'error'); return; }
      const row = document.createElement('div');
      row.className = 'keywords-row';
      const input = document.createElement('input');
      input.className = 'keyword';
      input.placeholder = `ÙƒÙ„Ù…Ø© Ù…ÙØªØ§Ø­ÙŠØ© ${count + 1}`;
      input.type = 'text';
      row.appendChild(input);

      const removeBtn = document.createElement('button');
      removeBtn.type = 'button';
      removeBtn.textContent = 'âœ–';
      removeBtn.style.background='transparent';
      removeBtn.style.border='0';
      removeBtn.style.cursor='pointer';
      removeBtn.addEventListener('click', ()=>row.remove());
      row.appendChild(removeBtn);

      keywordsContainer.appendChild(row);
    });

    // Ø¹Ø±Ø¶ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© ÙÙŠØ¯ÙŠÙˆ
    addBtn.addEventListener('click', async () => {
      // Ø¬Ù„Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠ Ø£ÙˆÙ„Ø§Ù‹
      await loadVideos();
      if (currentVideos.length >= 4) {
        showMessage('Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø£ÙƒØ«Ø± Ù…Ù† 4 ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª. Ø§Ø­Ø°Ù ÙÙŠØ¯ÙŠÙˆÙ‹Ø§ Ø£ÙˆÙ„Ø§Ù‹.', 'error');
        return;
      }
      addForm.classList.remove('hidden');
      videosSection.classList.add('hidden');
      window.scrollTo(0,0);
    });

    // Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª
    listBtn.addEventListener('click', () => {
      videosSection.classList.remove('hidden');
      addForm.classList.add('hidden');
      loadVideos();
    });

    cancelBtn.addEventListener('click', () => {
      addForm.classList.add('hidden');
    });

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…
    async function loadVideos(){
      if (!userId) {
        videosTableBody.innerHTML = '<tr><td colspan="5">ÙŠØ±Ø¬Ù‰ ØªÙ…Ø±ÙŠØ± user_id ÙÙŠ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙØ­Ø©</td></tr>';
        return;
      }
      try {
        const res = await fetch(`/api/my-videos?user_id=${encodeURIComponent(userId)}`);
        if (!res.ok) {
          videosTableBody.innerHTML = `<tr><td colspan="5">Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</td></tr>`;
          return;
        }
        let videos = await res.json();
        if (!Array.isArray(videos)) videos = [];
        currentVideos = videos;

        if (videos.length === 0) {
          videosTableBody.innerHTML = `<tr><td colspan="5">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</td></tr>`;
          return;
        }

        videosTableBody.innerHTML = videos.map(v => {
          // ØªØ£ÙƒØ¯ keywords
          let kw = v.keywords || [];
          if (typeof kw === 'string') {
            try { kw = JSON.parse(kw); } catch { kw = []; }
          }
          const kwText = (Array.isArray(kw) && kw.length > 0) ? kw.join(', ') : 'Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø§Øª';
          return `<tr>
                    <td>${escapeHtml(v.title)}</td>
                    <td>${v.duration_seconds}</td>
                    <td>${v.views_count || 0}</td>
                    <td>${escapeHtml(kwText)}</td>
                    <td><button class="deleteBtn" data-id="${v.id}">Ø­Ø°Ù</button></td>
                  </tr>`;
        }).join('');
        // attach delete handlers
        document.querySelectorAll('.deleteBtn').forEach(btn=>{
          btn.addEventListener('click', ()=> deleteVideo(btn.dataset.id));
        });
      } catch (err) {
        videosTableBody.innerHTML = `<tr><td colspan="5">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…</td></tr>`;
      }
    }

    // Ù…Ù†Ø¹ XSS Ø¨Ø³ÙŠØ·
    function escapeHtml(s){
      if (!s && s !== 0) return '';
      return String(s).replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]; });
    }

    // Ø¥Ø¶Ø§ÙØ© ÙÙŠØ¯ÙŠÙˆ â€” Ù†Ù…Ø±Ù‘Ø± Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ø§Ù„ØªÙŠ ØªÙØ·Ù„Ø¨ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£ØµÙ„ÙŠ
    submitBtn.addEventListener('click', async () => {
      // ØªØ­Ù‚Ù‚ Ø§Ù„Ø¹Ø¯Ø¯ Ù…Ø¬Ø¯Ø¯Ù‹Ø§
      await loadVideos();
      if (currentVideos.length >= 4) { showMessage('Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø£ÙƒØ«Ø± Ù…Ù† 4 ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª.', 'error'); return; }

      const title = document.getElementById('title').value.trim();
      const url = document.getElementById('url').value.trim();
      const minD = parseInt(document.getElementById('min_duration').value,10) || 0;
      const maxD = parseInt(document.getElementById('max_duration').value,10) || 0;

      const keywordInputs = keywordsContainer.querySelectorAll('input.keyword');
      const keywords = Array.from(keywordInputs).map(i=>i.value.trim()).filter(x=>x.length>0).slice(0,5);

      if (!title || !url || !minD || !maxD) { showMessage('Ø§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Ø§Ù„Ø¹Ù†ÙˆØ§Ù†ØŒ Ø§Ù„Ø±Ø§Ø¨Ø·ØŒ Ø§Ù„Ù…Ø¯Ø©)', 'error'); return; }
      if (minD < 50 || maxD < 50) { showMessage('Ø§Ù„Ù…Ø¯Ø© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 50 Ø«Ø§Ù†ÙŠØ© Ø£Ùˆ Ø£ÙƒØ«Ø±', 'error'); return; }
      if (minD > maxD) { showMessage('Ø­Ø¯Ù‘ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰', 'error'); return; }

      if (!userId) { showMessage('user_id Ù…ÙÙ‚ÙˆØ¯ ÙÙŠ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙØ­Ø©', 'error'); return; }

      // Ù†Ø­Ø¯Ø¯ Ù…Ø¯Ø© Ù…ÙØ±Ø³Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…: Ù†Ø³ØªØ®Ø¯Ù… Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø¯Ù‰ Ø£Ùˆ Ù†Ø±Ø³Ù„ min (Ø§Ù„Ø®Ø§Ø¯Ù… ÙŠØªÙˆÙ‚Ø¹ duration_seconds)
      const duration_seconds = Math.round((minD + maxD)/2);

      // Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø«Ø§Ø¨ØªØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£ØµÙ„ÙŠ (ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª):
      const payload = {
        user_id: userId,
        title,
        video_url: url,
        duration_seconds,
        // Ø§Ù„ÙƒÙ„Ù…Ø§Øª ØªØ­ÙØ¸ ÙƒÙ…ØµÙÙˆÙØ©
        keywords,
        // Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ø§Ù„ØªÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù€ Start.js Ù‚Ø¯ ØªØªÙˆÙ‚Ø¹Ù‡Ø§:
        viewing_method: 'keyword', // Ø«Ø§Ø¨Øª ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª
        like: 'no',
        subscribe: 'no',
        comment: 'no',
        comment_like: 'no'
      };

      try {
        submitBtn.disabled = true;
        submitBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©...';
        const res = await fetch('/api/add-video', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        const data = await res.json();
        if (res.ok && data.success) {
          showMessage('âœ… ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­', 'success');
          // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ù‚ÙˆÙ„
          document.getElementById('title').value = '';
          document.getElementById('url').value = '';
          document.getElementById('min_duration').value = 60;
          document.getElementById('max_duration').value = 120;
          // Ø§Ø¨Ù‚Ø§Ø¡ Ø£ÙˆÙ„ keyword ÙˆØ­Ø°Ù Ø§Ù„Ø¨Ø§Ù‚ÙŠ
          const allKw = keywordsContainer.querySelectorAll('input.keyword');
          allKw.forEach((el,i)=>{ if(i>0) el.parentElement.remove(); else el.value=''; });

          addForm.classList.add('hidden');
          videosSection.classList.remove('hidden');
          await loadVideos();
        } else {
          showMessage('Ø®Ø·Ø£: ' + (data.error || JSON.stringify(data)), 'error');
        }
      } catch (err) {
        showMessage('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…', 'error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ';
      }
    });

    // Ø­Ø°Ù ÙÙŠØ¯ÙŠÙˆ
    async function deleteVideo(videoId){
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ÙÙŠØ¯ÙŠÙˆØŸ')) return;
      try {
        const res = await fetch('/api/delete-video', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ user_id: userId, video_id: videoId })
        });
        const data = await res.json();
        if (res.ok && data.success) {
          showMessage('âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù', 'success');
          loadVideos();
        } else {
          showMessage('Ø®Ø·Ø£: ' + (data.error || 'Ø­Ø¯Ø« Ø®Ø·Ø£'), 'error');
        }
      } catch (err) {
        showMessage('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…', 'error');
      }
    }

    // Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ user_id
    (function init(){
      if (userId) {
        videosSection.classList.remove('hidden');
        addForm.classList.add('hidden');
        loadVideos();
      } else {
        // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯ user_id Ù†Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ¹Ù„ÙŠÙ…Ø§Øª
        showMessage('Ù…Ø±Ù‘Ø± user_id ÙÙŠ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙØ­Ø© Ù„Ø¹Ø±Ø¶ ÙˆØ¥Ø¯Ø§Ø±Ø© ÙÙŠØ¯ÙŠÙˆÙ‡Ø§ØªÙƒ. Ù…Ø«Ø§Ù„: ?user_id=6940442249', 'error');
        addForm.classList.remove('hidden');
        videosSection.classList.add('hidden');
      }
    })();
  </script>
</body>
</html>
